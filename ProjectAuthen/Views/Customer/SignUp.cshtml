@model ProjectModelCommon.Model.CustomerUser

@{
    ViewBag.Title = "SignUp";
    Layout = "~/Views/Shared/_LayoutEmpty.cshtml";
}

<link href="~/Content/SignInAndUp/Signin.css" rel="stylesheet" />
<link href="~/Content/SignInAndUp/CommonStyle.css" rel="stylesheet" />
<script src="~/Content/assets/js/jsCheckInput.js"></script>

@*<div class="form-horizontal">
        @Html.AntiForgeryToken()
        <h4>CustomerUserModel</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.UserName, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.UserName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.UserName, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Password, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.PasswordFor(model => model.Password, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.Password, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Phone, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Phone, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Phone, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Avatar, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Avatar, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Avatar, "", new { @class = "text-danger" })
            </div>
        </div>



        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Đăng ký" class="btn btn-default btn-signup" />
            </div>
        </div>
    </div>*@

<div class="container-signin">
    @Html.AntiForgeryToken()
    <div class="form-signin">
        <span class="tile-signin">Đăng ký</span>
        <span class="error-text" style="color:red;display:flex;align-items: center;justify-content: center;"></span>

        <div class="form-group common-input" data-validate="Họ tên không hợp lệ">
            <label for="exampleInput1">Họ tên</label>
            <input type="text" id="exampleInput1" name="Name" placeholder="Họ tên">
            <span class="focus-input3 focus-input"></span>
        </div>
        <div class="form-group common-input" data-validate="Trùng tên đăng nhập">
            <label for="exampleInput2">Tên đăng nhập</label>
            <input type="text" id="exampleInput2" name="UserName" placeholder="Tên đăng nhập">
            <span class="focus-input1 focus-input"></span>
        </div>
        <div class="form-group common-input" data-validate="Mật khẩu không chính xác">
            <label for="exampleInput3">Mật khẩu</label>
            <input type="password" id="exampleInput3" name="Password" placeholder="Mật khẩu">
            <span class="focus-input2 focus-input"></span>
        </div>
        <div class="form-group common-input" data-validate="Mật khẩu không chính xác">
            <label for="exampleInput4">Nhập lại mật khẩu</label>
            <input type="password" id="exampleInput4" name="configPassword" placeholder="Nhập lại mật khẩu">
            <span class="focus-input2 focus-input"></span>
        </div>
        <div class="form-group common-input" data-validate="Email không hợp lệ">
            <label for="exampleInput5">Địa chỉ email</label>
            <input type="text" id="exampleInput5" name="Email" placeholder="Địa chỉ email">
            <span class="focus-input4 focus-input"></span>
        </div>
        <div class="form-group common-input" data-validate="Số điện thoại không hợp lệ">
            <label for="exampleInput6">Số điện thoại</label>
            <input type="text" id="exampleInput6" name="Phone" placeholder="Số điện thoại">
            <span class="focus-input5 focus-input"></span>
        </div>
        @*<div class="text-password">
                <a href="#" class="forgot-password">Quên mật khẩu</a>
            </div>*@
        <div class="form-buttom-signin">
            <button type="submit" class="btn btn-default btn-signup">ĐĂNG KÝ</button>
        </div>
        @*<div class="label-social">
                <p> hoặc sử dụng</p>
            </div>
            <div class="form-social">
                <a href="#" class="signin-face signin-social"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="signin-google signin-social"><i class="fab fa-google"></i></a>
            </div>*@
        <div class="label-social link-signup" style="margin-top: 35px;margin-bottom: 0px;">
            <a href="@Url.Action("signin","Customer")"> ĐĂNG NHẬP</a>
        </div>
    </div>
</div>
<div class="loading-page">
    <img src="~/Images/loading.gif" />
</div>

<script>
    $(function () {
        showhide();
        var addAntiForgeryToken = function (data) {
            data.__RequestVerificationToken = $("[name='__RequestVerificationToken']").val();
            return data;
        }; //addAntiForgeryToken
        $(".btn-signup").on("click", function () {
            let username = $("input[name='UserName']").val();
            let email = $("input[name='Email']").val();
            let phone = $("input[name='Phone']").val();
            let avatar = $("input[name='Avatar']").val();
            let name = $("input[name='Name']").val();
            let pass = $("input[name='Password']").val();
            if (validateSignUp(name, username, pass, email, phone) && CheckExitUser(name, username, pass, email, phone) && validatePasswork(pass, $("input[name='configPassword']").val())) {
                $.ajax({
                    url: '/Customer/SignUp',
                    type: 'POST',
                    data: { __RequestVerificationToken: $("[name='__RequestVerificationToken']").val(), UserName: username, Email: email, Phone: phone, Avatar: avatar, Name: name, Password: pass },
                    async: true,
                    success: function (result) {
                        console.log(result);
                        if (!result) {
                            $(".error-text").text("Lỗi hệ thông");
                        } else {
                            //window.history.back();
                            let urlParams = new URLSearchParams(location.search);
                            window.location.href = urlParams.get("ReturnUrl");
                        }
                    },
                    error: function (error) {
                        console.log("ERROR:" + error);
                    }
                });
            }
        })
        /**
         * show hide loading*/
        function showhide() {
            $(".loading-page").toggle();
        }
        /**
         * validate signup
         */
        function validateSignUp(Name, UserName, Password, Email, Phone) {
            check = true;
            if (!validateText(Name, "", 5, 200)) {
                $("input[name='Name']").parents(".form-group").addClass("validate-input");
                check = false;
            }
            if (!validateText(UserName, "", 5, 200)) {
                $("input[name='UserName']").parents(".form-group").addClass("validate-input");
                check = false;
            }
            if (!validateText(Password, "", 5, 200)) {
                $("input[name='Password']").parents(".form-group").addClass("validate-input");
                check = false;
            }
            if (!validateText(Email, "email", 5, 200)) {
                $("input[name='Email']").parents(".form-group").addClass("validate-input");
                check = false;
            }
            if (!validateText(Phone, "phone", 9, 200)) {
                $("input[name='Phone']").parents(".form-group").addClass("validate-input");
                check = false;
            }
            return (check == true) ? true : false;
        }

        /**
         * validate passwork
         */
        function validatePasswork(passwork, configPasswork) {
            if (passwork != configPasswork) {
                $("input[name='configPassword']").parents(".form-group").addClass("validate-input");
                $("input[name='configPassword']").parents(".form-group").attr("data-validate", "Mật khẩu không trùng");
                return false;
            }
            return true;
        }
        $("input[name='Name'],input[name='UserName'],input[name='Password'],input[name='Email'],input[name='Phone']").on("focus", function () {
            $(this).parents(".form-group").removeClass("validate-input");
        })

        function CheckExitUser(Name, UserName, Password, Email, Phone) {
            let check = true;
            $.ajax({
                url: '/Customer/CheckEmailUserPhone',
                type: 'POST',
                data: { __RequestVerificationToken: $("[name='__RequestVerificationToken']").val(), UserName: UserName, Email: Email, Phone: Phone, Name: Name, Password: Password },
                async: false,
                success: function (result) {
                    console.log(result);
                    if (result == 0) { check = true;}
                    else
                        if (result == 1) {
                            $("input[name='Email']").parents(".form-group").attr("data-validate", "Email đã tồn tại");
                            $("input[name='Email']").parents(".form-group").addClass("validate-input");
                            check = false;
                        } else
                            if (result == 2) {
                                $("input[name='Phone']").parents(".form-group").attr("data-validate", "Số điện thoại đã tồn tại");
                                $("input[name='Phone']").parents(".form-group").addClass("validate-input");
                                check = false;
                            } else
                                if (result == 3) {
                                    $("input[name='UserName']").parents(".form-group").attr("data-validate", "Tên đăng nhập đã tồn tại");
                                    $("input[name='UserName']").parents(".form-group").addClass("validate-input");
                                    check = false;
                                }
                    //if (!result) {
                    //    $(".error-text").text("Lỗi hệ thống");
                    //} else {
                    //    window.history.back();
                    //}
                },
                error: function (error) {
                    console.log("ERROR:" + error);
                }
            });
            return check;
        }
    })

</script>
